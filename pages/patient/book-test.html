<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Test - DoorToTest</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <link href="../../css/style.css" rel="stylesheet">
    <!-- Razorpay Checkout Script -->
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>
<body>
    <div class="dashboard-wrapper">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h4><img src="../../images/logo.png" alt="DoorToTest" width="42" height="42"> Door<span>ToTest</span></h4>
            </div>
            <ul class="sidebar-menu">
                <li><a href="dashboard.html"><i class="bi bi-grid-1x2"></i> Dashboard</a></li>
                <li><a href="book-test.html" class="active"><i class="bi bi-plus-circle"></i> Book Test</a></li>
                <li><a href="reports.html"><i class="bi bi-file-earmark-medical"></i> My Reports</a></li>
                <li><a href="profile.html"><i class="bi bi-person"></i> Profile</a></li>
                <li><a href="../public/tests.html"><i class="bi bi-list-ul"></i> Browse Tests</a></li>
                <li><a href="../public/doctors.html"><i class="bi bi-person-badge"></i> Consult Doctor</a></li>
                <li><a href="#" onclick="API.Auth.logout()"><i class="bi bi-box-arrow-left"></i> Logout</a></li>
            </ul>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Navbar -->
            <div class="top-navbar">
                <button class="btn btn-link d-lg-none" onclick="toggleSidebar()">
                    <i class="bi bi-list fs-4"></i>
                </button>
                <h5 class="mb-0">Book Blood Test</h5>
                <div class="user-menu">
                    <div class="user-info">
                        <img src="https://randomuser.me/api/portraits/men/1.jpg" alt="User">
                        <span id="userName">User</span>
                    </div>
                </div>
            </div>

            <!-- Content Area -->
            <div class="content-area">
                <!-- Booking Steps -->
                <div class="booking-steps mb-5">
                    <div class="booking-step active" id="step1Indicator">
                        <span class="step-number">1</span>
                        <span class="step-label">Select Tests</span>
                    </div>
                    <div class="booking-step" id="step2Indicator">
                        <span class="step-number">2</span>
                        <span class="step-label">Schedule</span>
                    </div>
                    <div class="booking-step" id="step3Indicator">
                        <span class="step-number">3</span>
                        <span class="step-label">Address</span>
                    </div>
                    <div class="booking-step" id="step4Indicator">
                        <span class="step-number">4</span>
                        <span class="step-label">Payment</span>
                    </div>
                </div>

                <!-- Loading State -->
                <div id="loadingState" class="text-center py-5" style="display: none;">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-3">Loading tests...</p>
                </div>

                <!-- Step 1: Select Tests -->
                <div id="step1" class="booking-step-content">
                    <div class="row">
                        <div class="col-lg-8">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title mb-4">Select Tests</h5>
                                    <div class="row mb-3">
                                        <div class="col-md-8">
                                            <input type="text" class="form-control" id="searchTests" placeholder="Search tests...">
                                        </div>
                                        <div class="col-md-4">
                                            <select class="form-select" id="categoryFilter">
                                                <option value="">All Categories</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div id="testsList" class="row g-3">
                                        <!-- Tests will be loaded here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 mt-4 mt-lg-0">
                            <div class="card sticky-top" style="top: 100px;">
                                <div class="card-body">
                                    <h5 class="card-title mb-4">Cart Summary</h5>
                                    <div id="cartItems">
                                        <p class="text-muted text-center">No tests selected</p>
                                    </div>
                                    <hr>
                                    <div class="d-flex justify-content-between mb-3">
                                        <strong>Total</strong>
                                        <strong id="cartTotal">₹0</strong>
                                    </div>
                                    <button class="btn btn-primary w-100" onclick="goToStep(2)" id="proceedBtn" disabled>
                                        Proceed <i class="bi bi-arrow-right ms-2"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Schedule -->
                <div id="step2" class="booking-step-content" style="display: none;">
                    <div class="row justify-content-center">
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title mb-4">Select Date & Time</h5>
                                    <div class="mb-4">
                                        <label class="form-label">Preferred Date</label>
                                        <input type="date" class="form-control" id="bookingDate" required>
                                    </div>
                                    <div class="mb-4">
                                        <label class="form-label">Preferred Time Slot</label>
                                        <div class="row g-2" id="timeSlots">
                                            <div class="col-4"><button type="button" class="btn btn-outline-primary w-100 time-slot" data-time="07:00 AM">07:00 AM</button></div>
                                            <div class="col-4"><button type="button" class="btn btn-outline-primary w-100 time-slot" data-time="08:00 AM">08:00 AM</button></div>
                                            <div class="col-4"><button type="button" class="btn btn-outline-primary w-100 time-slot" data-time="09:00 AM">09:00 AM</button></div>
                                            <div class="col-4"><button type="button" class="btn btn-outline-primary w-100 time-slot" data-time="10:00 AM">10:00 AM</button></div>
                                            <div class="col-4"><button type="button" class="btn btn-outline-primary w-100 time-slot" data-time="11:00 AM">11:00 AM</button></div>
                                            <div class="col-4"><button type="button" class="btn btn-outline-primary w-100 time-slot" data-time="12:00 PM">12:00 PM</button></div>
                                            <div class="col-4"><button type="button" class="btn btn-outline-primary w-100 time-slot" data-time="02:00 PM">02:00 PM</button></div>
                                            <div class="col-4"><button type="button" class="btn btn-outline-primary w-100 time-slot" data-time="03:00 PM">03:00 PM</button></div>
                                            <div class="col-4"><button type="button" class="btn btn-outline-primary w-100 time-slot" data-time="04:00 PM">04:00 PM</button></div>
                                        </div>
                                    </div>
                                    <div class="d-flex gap-2">
                                        <button class="btn btn-outline-secondary" onclick="goToStep(1)">
                                            <i class="bi bi-arrow-left me-2"></i>Back
                                        </button>
                                        <button class="btn btn-primary flex-fill" onclick="goToStep(3)" id="scheduleNext">
                                            Continue <i class="bi bi-arrow-right ms-2"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Address -->
                <div id="step3" class="booking-step-content" style="display: none;">
                    <div class="row justify-content-center">
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title mb-4">Collection Address</h5>
                                    <form id="addressForm">
                                        <div class="mb-3">
                                            <label class="form-label">Full Name</label>
                                            <input type="text" class="form-control" id="patientName" required>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Phone Number</label>
                                            <input type="tel" class="form-control" id="patientPhone" required>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Address Line 1</label>
                                            <input type="text" class="form-control" id="addressLine1" placeholder="House/Flat No., Building Name" required>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Address Line 2</label>
                                            <input type="text" class="form-control" id="addressLine2" placeholder="Street, Area">
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-6">
                                                <label class="form-label">City</label>
                                                <input type="text" class="form-control" id="city" required>
                                            </div>
                                            <div class="col-6">
                                                <label class="form-label">PIN Code</label>
                                                <input type="text" class="form-control" id="pincode" required>
                                            </div>
                                        </div>
                                        <div class="d-flex gap-2">
                                            <button type="button" class="btn btn-outline-secondary" onclick="goToStep(2)">
                                                <i class="bi bi-arrow-left me-2"></i>Back
                                            </button>
                                            <button type="submit" class="btn btn-primary flex-fill">
                                                Review & Pay <i class="bi bi-arrow-right ms-2"></i>
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 4: Payment -->
                <div id="step4" class="booking-step-content" style="display: none;">
                    <div class="row justify-content-center">
                        <div class="col-lg-8">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title mb-4">Review & Pay</h5>

                                    <div class="row">
                                        <div class="col-md-6">
                                            <h6 class="text-muted mb-3">Selected Tests</h6>
                                            <div id="confirmTests"></div>
                                        </div>
                                        <div class="col-md-6">
                                            <h6 class="text-muted mb-3">Schedule</h6>
                                            <p><i class="bi bi-calendar me-2"></i><span id="confirmDate"></span></p>
                                            <p><i class="bi bi-clock me-2"></i><span id="confirmTime"></span></p>

                                            <h6 class="text-muted mb-3 mt-4">Collection Address</h6>
                                            <p id="confirmAddress"></p>
                                        </div>
                                    </div>

                                    <hr>

                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="d-flex justify-content-between mb-2">
                                                <span>Subtotal</span>
                                                <span id="confirmSubtotal">₹0</span>
                                            </div>
                                            <div class="d-flex justify-content-between mb-2">
                                                <span>Home Collection</span>
                                                <span class="text-success">FREE</span>
                                            </div>
                                            <div class="d-flex justify-content-between mb-2">
                                                <span>Discount</span>
                                                <span class="text-success" id="confirmDiscount">-₹0</span>
                                            </div>
                                            <hr>
                                            <div class="d-flex justify-content-between">
                                                <strong>Total Amount</strong>
                                                <strong class="text-primary fs-5" id="confirmTotal">₹0</strong>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="alert alert-info mt-4">
                                        <i class="bi bi-shield-check me-2"></i>
                                        <strong>Secure Payment:</strong> Your payment is secured by Razorpay. We accept all major cards, UPI, and net banking.
                                    </div>

                                    <div class="d-flex gap-2 mt-4">
                                        <button class="btn btn-outline-secondary" onclick="goToStep(3)">
                                            <i class="bi bi-arrow-left me-2"></i>Back
                                        </button>
                                        <button class="btn btn-primary flex-fill" onclick="createBookingAndPay()" id="payBtn">
                                            <i class="bi bi-credit-card me-2"></i>Pay Now
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Processing Payment -->
                <div id="processingPayment" class="booking-step-content" style="display: none;">
                    <div class="row justify-content-center">
                        <div class="col-lg-6 text-center">
                            <div class="card p-5">
                                <div class="spinner-border text-primary mb-4" style="width: 3rem; height: 3rem; margin: 0 auto;">
                                    <span class="visually-hidden">Processing...</span>
                                </div>
                                <h4>Processing Payment</h4>
                                <p class="text-muted">Please wait while we process your payment...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Booking Success -->
                <div id="bookingSuccess" class="booking-step-content" style="display: none;">
                    <div class="row justify-content-center">
                        <div class="col-lg-6 text-center">
                            <div class="card p-5">
                                <i class="bi bi-check-circle text-success display-1 mb-4"></i>
                                <h3>Payment Successful!</h3>
                                <p class="text-muted mb-2">Your booking has been confirmed.</p>
                                <p class="text-muted mb-4">Booking ID: <strong id="bookingId"></strong></p>
                                <div class="alert alert-success">
                                    <i class="bi bi-envelope me-2"></i>
                                    A confirmation email has been sent to your registered email address.
                                </div>
                                <p class="text-muted">Our phlebotomist will arrive at your location on the scheduled date and time.</p>
                                <div class="d-flex gap-2 justify-content-center mt-4">
                                    <a href="dashboard.html" class="btn btn-primary">Go to Dashboard</a>
                                    <a href="book-test.html" class="btn btn-outline-primary" onclick="location.reload()">Book Another Test</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../../js/api.js"></script>
    <script>
        // Check authentication
        if (!API.Auth.isLoggedIn()) {
            window.location.href = 'login.html';
        }

        const user = API.Auth.getCurrentUser();
        let allTests = [];
        let selectedTests = [];
        let selectedDate = '';
        let selectedTime = '';
        let currentBookingId = null;

        // Initialize page
        document.addEventListener('DOMContentLoaded', async function() {
            if (user) {
                document.getElementById('userName').textContent = user.name;
                document.getElementById('patientName').value = user.name;
                document.getElementById('patientPhone').value = user.phone || '';
            }

            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('bookingDate').min = today;

            // Load tests from API
            await loadTests();

            // Load cart from localStorage
            loadCartFromStorage();

            // Load categories
            await loadCategories();

            // Setup event listeners
            setupEventListeners();
        });

        // Load cart items from localStorage
        function loadCartFromStorage() {
            const cart = Utils.getCart();
            if (cart && cart.length > 0) {
                // Match cart items with loaded tests from API
                cart.forEach(cartItem => {
                    const test = allTests.find(t => t.id === cartItem.id);
                    if (test && !selectedTests.find(t => t.id === test.id)) {
                        selectedTests.push(test);
                    }
                });
                updateCart();
                renderTests();
            }
        }

        // Load tests from API
        async function loadTests() {
            document.getElementById('loadingState').style.display = 'block';
            document.getElementById('step1').style.display = 'none';

            try {
                const response = await API.Tests.getAll();
                if (response.success) {
                    allTests = response.data;
                    renderTests();
                } else {
                    Utils.showToast('Failed to load tests', 'danger');
                }
            } catch (error) {
                console.error('Load tests error:', error);
                Utils.showToast('Failed to load tests. Please try again.', 'danger');
            } finally {
                document.getElementById('loadingState').style.display = 'none';
                document.getElementById('step1').style.display = 'block';
            }
        }

        // Load categories
        async function loadCategories() {
            try {
                const response = await API.Tests.getCategories();
                if (response.success) {
                    const select = document.getElementById('categoryFilter');
                    response.data.forEach(cat => {
                        const option = document.createElement('option');
                        option.value = cat.category;
                        option.textContent = cat.category;
                        select.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Load categories error:', error);
            }
        }

        // Render tests
        function renderTests() {
            const searchTerm = document.getElementById('searchTests').value.toLowerCase();
            const category = document.getElementById('categoryFilter').value;

            const filteredTests = allTests.filter(test => {
                const matchesSearch = test.name.toLowerCase().includes(searchTerm) ||
                    (test.description && test.description.toLowerCase().includes(searchTerm));
                const matchesCategory = !category || test.category === category;
                return matchesSearch && matchesCategory && test.is_active;
            });

            const container = document.getElementById('testsList');

            if (filteredTests.length === 0) {
                container.innerHTML = '<div class="col-12 text-center py-5 text-muted">No tests found</div>';
                return;
            }

            container.innerHTML = filteredTests.map(test => `
                <div class="col-md-6">
                    <div class="card h-100 ${selectedTests.find(t => t.id === test.id) ? 'border-primary' : ''}">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <h6 class="card-title mb-1">${test.name}</h6>
                                    <span class="badge bg-light text-dark">${test.category}</span>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="test${test.id}"
                                        ${selectedTests.find(t => t.id === test.id) ? 'checked' : ''}
                                        onchange="toggleTest(${test.id})">
                                </div>
                            </div>
                            <p class="text-muted small mt-2 mb-2">${test.description || ''}</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <span class="fw-bold text-primary">₹${test.price}</span>
                                    ${test.original_price > test.price ?
                                        `<span class="text-muted text-decoration-line-through small ms-2">₹${test.original_price}</span>` : ''}
                                </div>
                                <small class="text-muted">${test.report_time}</small>
                            </div>
                            ${test.fasting_required ? '<small class="text-warning d-block mt-2"><i class="bi bi-exclamation-triangle"></i> Fasting required</small>' : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Toggle test selection
        function toggleTest(testId) {
            const test = allTests.find(t => t.id === testId);
            if (!test) return;

            const index = selectedTests.findIndex(t => t.id === testId);
            if (index > -1) {
                selectedTests.splice(index, 1);
                // Also remove from localStorage cart
                Utils.removeFromCart(testId);
            } else {
                selectedTests.push(test);
                // Also add to localStorage cart
                Utils.addToCart(test);
            }

            updateCart();
            renderTests();
        }

        // Update cart display
        function updateCart() {
            const cartItems = document.getElementById('cartItems');
            const cartTotal = document.getElementById('cartTotal');
            const proceedBtn = document.getElementById('proceedBtn');

            if (selectedTests.length === 0) {
                cartItems.innerHTML = '<p class="text-muted text-center">No tests selected</p>';
                cartTotal.textContent = '₹0';
                proceedBtn.disabled = true;
            } else {
                cartItems.innerHTML = selectedTests.map(test => `
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="small">${test.name}</span>
                        <div>
                            <span class="small">₹${test.price}</span>
                            <button class="btn btn-sm btn-link text-danger p-0 ms-2" onclick="toggleTest(${test.id})">
                                <i class="bi bi-x"></i>
                            </button>
                        </div>
                    </div>
                `).join('');

                const total = selectedTests.reduce((sum, test) => sum + parseFloat(test.price), 0);
                cartTotal.textContent = '₹' + total.toFixed(2);
                proceedBtn.disabled = false;
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // Search
            document.getElementById('searchTests').addEventListener('input', renderTests);
            document.getElementById('categoryFilter').addEventListener('change', renderTests);

            // Time slots
            document.querySelectorAll('.time-slot').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.time-slot').forEach(b => {
                        b.classList.remove('btn-primary');
                        b.classList.add('btn-outline-primary');
                    });
                    this.classList.remove('btn-outline-primary');
                    this.classList.add('btn-primary');
                    selectedTime = this.dataset.time;
                });
            });

            // Address form
            document.getElementById('addressForm').addEventListener('submit', function(e) {
                e.preventDefault();
                goToStep(4);
            });
        }

        // Navigate between steps
        function goToStep(step) {
            // Validate before moving
            if (step === 2 && selectedTests.length === 0) {
                Utils.showToast('Please select at least one test', 'warning');
                return;
            }

            if (step === 3) {
                selectedDate = document.getElementById('bookingDate').value;
                if (!selectedDate) {
                    Utils.showToast('Please select a date', 'warning');
                    return;
                }
                if (!selectedTime) {
                    Utils.showToast('Please select a time slot', 'warning');
                    return;
                }
            }

            // Hide all steps
            document.querySelectorAll('.booking-step-content').forEach(el => el.style.display = 'none');

            // Show target step
            document.getElementById('step' + step).style.display = 'block';

            // Update indicators
            for (let i = 1; i <= 4; i++) {
                const indicator = document.getElementById('step' + i + 'Indicator');
                indicator.classList.remove('active', 'completed');
                if (i < step) {
                    indicator.classList.add('completed');
                } else if (i === step) {
                    indicator.classList.add('active');
                }
            }

            // If step 4, populate confirmation
            if (step === 4) {
                populateConfirmation();
            }
        }

        // Populate confirmation page
        function populateConfirmation() {
            document.getElementById('confirmTests').innerHTML = selectedTests.map(test => `
                <p class="mb-1"><i class="bi bi-check-circle text-success me-2"></i>${test.name} - ₹${test.price}</p>
            `).join('');

            document.getElementById('confirmDate').textContent = new Date(selectedDate).toLocaleDateString('en-IN', {
                weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
            });
            document.getElementById('confirmTime').textContent = selectedTime;

            const address = `${document.getElementById('patientName').value}<br>
                ${document.getElementById('addressLine1').value}<br>
                ${document.getElementById('addressLine2').value ? document.getElementById('addressLine2').value + '<br>' : ''}
                ${document.getElementById('city').value} - ${document.getElementById('pincode').value}<br>
                Phone: ${document.getElementById('patientPhone').value}`;
            document.getElementById('confirmAddress').innerHTML = address;

            const subtotal = selectedTests.reduce((sum, test) => sum + parseFloat(test.original_price || test.price), 0);
            const total = selectedTests.reduce((sum, test) => sum + parseFloat(test.price), 0);
            const discount = subtotal - total;

            document.getElementById('confirmSubtotal').textContent = '₹' + subtotal.toFixed(2);
            document.getElementById('confirmDiscount').textContent = '-₹' + discount.toFixed(2);
            document.getElementById('confirmTotal').textContent = '₹' + total.toFixed(2);
        }

        // Create booking and initiate payment
        async function createBookingAndPay() {
            const payBtn = document.getElementById('payBtn');
            payBtn.disabled = true;
            payBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Processing...';

            try {
                // Create booking via API
                const bookingData = {
                    tests: selectedTests.map(t => t.id),
                    booking_date: selectedDate,
                    time_slot: selectedTime,
                    patient_name: document.getElementById('patientName').value,
                    phone: document.getElementById('patientPhone').value,
                    address_line1: document.getElementById('addressLine1').value,
                    address_line2: document.getElementById('addressLine2').value,
                    city: document.getElementById('city').value,
                    pincode: document.getElementById('pincode').value
                };

                const response = await API.Bookings.create(bookingData);

                if (!response.success) {
                    throw new Error(response.message || 'Failed to create booking');
                }

                currentBookingId = response.data.booking_id;
                const totalAmount = parseFloat(response.data.total_amount);

                // Initiate Razorpay payment
                initiatePayment(
                    currentBookingId,
                    totalAmount,
                    {
                        name: document.getElementById('patientName').value,
                        email: user.email,
                        phone: document.getElementById('patientPhone').value
                    },
                    // Success callback
                    function(result) {
                        showSuccess(currentBookingId);
                    },
                    // Error callback
                    function(error) {
                        payBtn.disabled = false;
                        payBtn.innerHTML = '<i class="bi bi-credit-card me-2"></i>Pay Now';
                        Utils.showToast(error.message || 'Payment failed. Please try again.', 'danger');
                    }
                );

            } catch (error) {
                console.error('Booking error:', error);
                payBtn.disabled = false;
                payBtn.innerHTML = '<i class="bi bi-credit-card me-2"></i>Pay Now';
                Utils.showToast(error.message || 'Failed to create booking', 'danger');
            }
        }

        // Show success page
        function showSuccess(bookingId) {
            document.querySelectorAll('.booking-step-content').forEach(el => el.style.display = 'none');
            document.getElementById('bookingSuccess').style.display = 'block';
            document.getElementById('bookingId').textContent = bookingId;

            // Hide step indicators
            document.querySelector('.booking-steps').style.display = 'none';

            // Clear cart (both local and localStorage)
            selectedTests = [];
            Utils.clearCart();
        }

        function toggleSidebar() {
            document.querySelector('.sidebar').classList.toggle('active');
        }
    </script>
</body>
</html>
